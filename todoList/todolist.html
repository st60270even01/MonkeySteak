<!DOCTYPE html>
<html>

<head>
    <title>Todo List</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="images/favicon.ico" rel="shortcut icon">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/stylesheets/all.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>

</head>

<body class="bg-lighter">

    <div class="container my-5">
        <div class="row">
            <div class="col-md-12 post">

                <h1 class="mt-0 text-muted">Todo List</h1>

                <div class="alert alert-secondary">
                    <ol class="mb-0">
                        <li>使用Vue及Bootstrap製作</li>
                    </ol>
                </div>


                <div id="app">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">待辦事項</span>
                        </div>
                        <input type="text" class="form-control" placeholder="輸入待辦事項" v-model="newTodo"
                            @keyup.enter="addTodo">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="button" @click="addTodo">新增</button>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item" @click.prevent="visibility = 'all'">
                                    <a class="nav-link" :class="{'active': visibility == 'all'}" href="#">全部</a>
                                </li>
                                <li class="nav-item" @click.prevent="visibility = 'active'">
                                    <a class="nav-link" :class="{'active': visibility == 'active'}" href="#">進行中</a>
                                </li>
                                <li class="nav-item" @click.prevent="visibility = 'completed'">
                                    <a class="nav-link" :class="{'active': visibility == 'completed'}" href="#">已完成</a>
                                </li>
                            </ul>
                        </div>

                        <ul class="list-group list-group-flush text-left">

                            <li class="list-group-item" v-for="(item,key) in filteredTodos" @dblclick="editTodo(item)">
                                <div class="d-flex" v-if='item.id !== cacheTodo.id'>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" v-model="item.completed"
                                            :id="item.id">
                                        <label class="form-check-label" :class="{'completed':item.completed}"
                                            :for="item.id">
                                            {{item.title}}
                                        </label>
                                    </div>
                                    <button type="button" class="close ml-auto" aria-label="Close"
                                        @click="removeTodo(item)">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <input type="text" class="form-control" v-model='cacheTitle'
                                    v-if='item.id == cacheTodo.id' @keyup.esc="cancelEdit"
                                    @keyup.enter="doneEdit(item)">
                            </li>
                        </ul>

                        <div class="card-footer d-flex justify-content-between">
                            <span>還有 {{undoneTodes}} 筆任務未完成</span>
                            <a href="#" @click.prevent="removeAll">清除所有任務</a>
                        </div>
                    </div>
                </div>

                <script>
                    var app = new Vue({
                        el: '#app',
                        data: {
                            newTodo: '',
                            todos: [{
                                id: '123',
                                title: 'eat',
                                completed: false
                            }],
                            cacheTodo: {},
                            cacheTitle: '',
                            visibility: 'all',
                        },
                        methods: {
                            addTodo: function () {
                                var value = this.newTodo.trim();
                                var timestamp = Math.floor(Date.now());
                                if (!value) {
                                    return
                                }
                                this.todos.push({
                                    id: timestamp,
                                    title: value,
                                    completed: false
                                })
                                this.newTodo = '';
                            },
                            removeTodo: function (todo) {
                                var vm = this;
                                var newIndex = vm.todos.findIndex(function (item, key) {
                                    return todo.id === item.id;
                                })
                                this.todos.splice(newIndex, 1);
                            },
                            editTodo: function (item) {
                                console.log(item);
                                this.cacheTodo = item;
                                this.cacheTitle = item.title;
                            },
                            cancelEdit: function () {
                                this.cacheTodo = {};
                            },
                            doneEdit: function (item) {
                                item.title = this.cacheTitle;
                                this.cacheTodo = {};
                            },
                            removeAll: function () {
                                this.todos = [];
                            },
                        },
                        computed: {
                            filteredTodos: function () {
                                if (this.visibility == 'all') {
                                    return this.todos;
                                } else if (this.visibility == 'active') {
                                    var newTodos = [];
                                    this.todos.forEach(function (item) {
                                        if (!item.completed) {
                                            newTodos.push(item);
                                        }
                                    });
                                    return newTodos;
                                } else if (this.visibility == 'completed') {
                                    var newTodos = [];
                                    this.todos.forEach(function (item) {
                                        if (item.completed) {
                                            newTodos.push(item);
                                        }
                                    });
                                    return newTodos;
                                }
                            },
                            undoneTodes: function () {
                                var undoSum = 0;
                                if (this.todos !== []) {
                                    this.todos.forEach(function (item) {
                                        if (item.completed == false) {
                                            undoSum += 1;
                                        }
                                    });
                                    return undoSum;
                                } else {
                                    return 0;
                                }
                            }
                        }
                    });
                </script>

                <style>
                    .completed {
                        text-decoration: line-through
                    }
                </style>

            </div>
        </div>
    </div>
</body>

</html>